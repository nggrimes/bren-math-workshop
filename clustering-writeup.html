<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bren Calculus Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="clustering-writeup_files/libs/clipboard/clipboard.min.js"></script>
<script src="clustering-writeup_files/libs/quarto-html/quarto.js"></script>
<script src="clustering-writeup_files/libs/quarto-html/popper.min.js"></script>
<script src="clustering-writeup_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="clustering-writeup_files/libs/quarto-html/anchor.min.js"></script>
<link href="clustering-writeup_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="clustering-writeup_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="clustering-writeup_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="clustering-writeup_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="clustering-writeup_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bren Calculus Workshop</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0      ✔ purrr   1.0.1 
✔ tibble  3.1.8      ✔ dplyr   1.0.10
✔ tidyr   1.3.0      ✔ stringr 1.5.0 
✔ readr   2.1.3      ✔ forcats 0.5.2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tibble' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'purrr' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'forcats' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googlesheets4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'googlesheets4' was built under R version 4.2.2</code></pre>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
</section>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data import</h2>
<p>First we need to get the dat in from the Google form responses. For that we use the <code>googlesheets4</code> package. Normally you have to connect it to your gmail account the first time you use it, but I’ve already done that behind the scences. All we need to do is provide the google sheet url link.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read_sheet</span>(<span class="st">"https://docs.google.com/spreadsheets/d/1EwUbwXUpAQvpXuF_zvK4aCXOP9ucYuam_r3xBgZ6cKw/edit?resourcekey#gid=967303810"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>timestamp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>! Using an auto-discovered, cached token.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  To suppress this message, modify your code or options to clearly consent to
  the use of a cached token.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  See gargle's "Non-interactive auth" vignette for more details:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  &lt;https://gargle.r-lib.org/articles/non-interactive-auth.html&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The googlesheets4 package is using a cached token for 'nggrimes@ucsb.edu'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Reading from "Bren Calculus Workshop Pre (Responses)".</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Range 'Form Responses 1'.</code></pre>
</div>
</div>
</section>
<section id="constrained-k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="constrained-k-means-clustering">Constrained K-means clustering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"specialization"</span>,<span class="st">"major"</span>,<span class="st">"math_level"</span>,<span class="st">"use"</span>,<span class="st">"relationship"</span>,<span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>likert<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">specialization=</span><span class="fu">case_when</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Business and Sustainability"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Environmental Policy"</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Coastal Resources and Management"</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Energy and Climate"</span><span class="sc">~</span><span class="dv">5</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Water Resources Management"</span><span class="sc">~</span><span class="dv">4</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Pollution Prevention and Remediation"</span><span class="sc">~</span><span class="dv">6</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    specialization<span class="sc">==</span><span class="st">"Conservation Planning"</span><span class="sc">~</span><span class="dv">7</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">major=</span><span class="fu">case_when</span>(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Humanities (History, Literature, Art)"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Business"</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Political Science"</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Environmental Science"</span><span class="sc">~</span><span class="dv">4</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"STEM (Biology, Chemistry, Physics)"</span><span class="sc">~</span><span class="dv">5</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Economics"</span><span class="sc">~</span><span class="dv">6</span>,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    major<span class="sc">==</span><span class="st">"Computer Science"</span><span class="sc">~</span><span class="dv">7</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">math_level=</span><span class="fu">case_when</span>(</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    math_level<span class="sc">==</span><span class="st">"Algebra"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    math_level<span class="sc">==</span><span class="st">"Trigonometry"</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    math_level<span class="sc">==</span><span class="st">"Calculus 1"</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    math_level<span class="sc">==</span><span class="st">"Calculus 2"</span><span class="sc">~</span><span class="dv">4</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    math_level<span class="sc">==</span><span class="st">"Calculus 3 and beyond (Diff eq, real analysis, if you know what those are click this option)"</span><span class="sc">~</span><span class="dv">5</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">use=</span><span class="fu">case_when</span>(</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    use<span class="sc">==</span><span class="st">"Less than a year"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    use<span class="sc">==</span><span class="st">"1-2 years ago"</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    use<span class="sc">==</span><span class="st">"3-5 years ago"</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    use<span class="sc">==</span><span class="st">"Not since the dark times (5+ years)"</span><span class="sc">~</span><span class="dv">4</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relationship=</span><span class="fu">case_when</span>(</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    relationship<span class="sc">==</span><span class="st">"My mortal enemy"</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    relationship<span class="sc">==</span><span class="st">"Your crazy, high key racist uncle you have to invite to Thanksgiving"</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    relationship<span class="sc">==</span><span class="st">"The friend of a friend who's name you can never remember"</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    relationship<span class="sc">==</span><span class="st">"Respectful co-worker you can have a beer with"</span><span class="sc">~</span><span class="dv">4</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    relationship<span class="sc">==</span><span class="st">"My best friend!"</span><span class="sc">~</span><span class="dv">5</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>likert <span class="sc">%&gt;%</span> </span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unname</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Practice data_frame with a "fully" populated sample</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>prac<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">spec=</span><span class="fu">sample.int</span>(<span class="dv">7</span>,<span class="dv">81</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),<span class="at">major=</span><span class="fu">sample.int</span>(<span class="dv">7</span>,<span class="dv">81</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),<span class="at">level=</span><span class="fu">sample.int</span>(<span class="dv">5</span>,<span class="dv">81</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),<span class="at">use=</span><span class="fu">sample.int</span>(<span class="dv">4</span>,<span class="dv">81</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),<span class="at">rel=</span><span class="fu">sample.int</span>(<span class="dv">5</span>,<span class="dv">81</span>,<span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>prac <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unname</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can add some settings on how big we want the groups to be or how many groups we want. For example if out a class of 80 we want group sizes of 4 we would need to tell the algorithm to make 20 groups. Since there might be an uneven number (like 83) we’ll tweak the max allowed in a group. For balanced sorting all groups must have at least one representative from each group. So the minimum size will be a rounding of the number of responses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>group_size<span class="ot">=</span><span class="dv">5</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>groups<span class="ot">=</span><span class="fu">floor</span>(<span class="fu">length</span>(df[,<span class="dv">1</span>])<span class="sc">/</span>group_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately, the next step requires us to step away from R because no one has developed an appropriate package for the algorithm we’re trying to use. Luckily for us, Quarto with <code>reticulate</code> makes running python and R code in the same workflow relatively easier. First we transfer the needed data from the R side to python suitable frames. Next we need to bring in the packages python needs to use for the algorithm. This is just like loading <code>library(tidyverse)</code> in R. Python also lets us name the package for our own personal uses. Personally, I rarely deviate from the authors recommendation. Next we set up the algorithm settings. Then call the alogrithm with a specific call much like we would in a TidyModels set up in R. We store the output in <code>labels</code> which is a vector of <code>[0:4]</code> of each students classifcation<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>r.df</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span><span class="bu">int</span>(r.groups)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>size<span class="op">=</span><span class="bu">int</span>(r.group_size)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> k_means_constrained <span class="im">import</span> KMeansConstrained</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>clf<span class="op">=</span>KMeansConstrained(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  n_clusters<span class="op">=</span>size,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  size_min<span class="op">=</span>group,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  size_max<span class="op">=</span>group<span class="op">+</span><span class="dv">2</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  random_state<span class="op">=</span><span class="dv">0</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>labels<span class="op">=</span>clf.fit_predict(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we bring the labels from python to R with a quick <code>reticulate::py</code> call. To add true randomness into the assignments, I make a function to mix up the names of each person in the clusters, and then apply to all using <code>purrr:map</code>. From there it’s a matter of converting the list into a usable dataframe while maintaining all the names. List data manipulation is almost more of an art than a science. Do whatever you need to do to make it work for your problem. Here I want to keep a general structure because I don’t know how many people will fill out the form beforehand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'reticulate' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>clus_labels<span class="ot">&lt;-</span>py<span class="sc">$</span>labels</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>prac<span class="sc">$</span>labels<span class="ot">=</span>clus_labels<span class="sc">+</span><span class="dv">1</span> <span class="do">## REPLACE PRAC WITH LIKERT BY DEMO  Keep the add 1 becuase of python base 0</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>prac<span class="sc">$</span>name<span class="ot">=</span>stringi<span class="sc">::</span><span class="fu">stri_rand_strings</span>(<span class="fu">length</span>(prac<span class="sc">$</span>labels),<span class="dv">6</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>prac</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   spec major level use rel labels   name
1     1     1     1   1   1      5 OqkXsS
2     4     1     2   3   4      1 0jiBeX
3     7     7     3   1   5      3 KdphL7
4     1     6     4   2   4      2 Ovnlxz
5     2     4     1   2   5      1 b1KH72
6     5     7     3   2   3      3 MKAcOx
7     7     5     5   4   3      3 eKC7zN
8     3     5     3   3   1      2 YjrZ0u
9     6     4     4   1   1      4 lN53op
10    2     6     2   3   2      2 e8Ljuh
11    3     5     1   1   5      1 EdHx9P
12    3     4     4   1   1      2 F5pWfP
13    1     4     1   1   3      5 qjLwe2
14    5     1     4   3   2      4 aP4Wxh
15    5     5     2   1   4      1 YFmepe
16    2     5     5   3   1      2 TUNRov
17    6     7     2   2   3      3 9kyyLO
18    6     6     2   1   1      3 w6vLXX
19    2     1     2   4   5      5 iP9Lc3
20    7     1     3   4   4      4 qDX8Kc
21    1     7     1   3   2      2 FdUwrM
22    7     7     2   3   5      3 JpSJ64
23    5     3     3   4   5      1 gfuIvC
24    5     6     3   4   3      3 nD1rgw
25    1     2     3   2   2      5 fqMOZ5
26    1     2     3   4   4      5 CakrNn
27    6     3     5   1   1      4 3cMauC
28    5     6     3   3   1      3 MflWpW
29    5     2     1   2   1      4 VQM7IH
30    2     7     2   4   3      2 lm8VbV
31    2     7     4   4   3      2 NQ0u4V
32    6     4     2   1   5      1 obQYmA
33    1     3     2   4   2      5 yTvtkf
34    4     5     4   2   5      1 e4QWwi
35    7     2     5   3   4      4 iT7mRQ
36    1     2     1   4   2      5 19Ql0b
37    4     1     5   1   2      4 uhGqKZ
38    3     3     5   4   2      4 Q3jXk3
39    6     3     5   4   4      4 iIHp52
40    2     2     4   2   1      5 LXbGCN
41    2     7     4   2   1      2 Tp7fUt
42    6     2     4   2   1      4 Y7RBQD
43    7     5     2   1   5      1 xRm9rC
44    4     2     1   1   1      5 BAZjsh
45    4     5     3   4   3      3 To1zdQ
46    4     4     1   4   3      1 1kCzui
47    2     7     1   1   3      2 jTrAcI
48    4     7     4   1   3      2 S2B3wL
49    1     5     5   2   1      2 WcEVoL
50    7     4     1   1   4      1 r2ykGf
51    6     6     3   4   4      3 LwK1LO
52    1     1     4   1   5      5 MxNXvu
53    4     3     5   4   4      4 FiLYko
54    1     2     4   3   1      5 r2DMIj
55    7     3     1   2   5      1 huqmOZ
56    6     3     1   3   5      1 4sxVv8
57    2     1     5   1   2      5 EUTQ2d
58    7     5     5   3   4      3 iLwk3y
59    3     6     1   2   3      2 D2GiFE
60    2     6     5   1   1      2 1Gg23O
61    6     6     4   4   5      3 Udi4Qy
62    6     4     2   4   5      1 oDU0GS
63    2     4     2   1   3      5 jzKwxt
64    5     1     1   4   4      1 UmngaK
65    2     5     5   2   1      2 0450K7
66    6     5     5   3   3      3 a20Apl
67    6     6     2   3   3      3 GBD339
68    6     1     5   3   4      4 42Wmh4
69    1     3     2   3   1      5 1R9ihs
70    3     6     4   2   1      2 Kyz2to
71    3     3     2   4   3      5 iHVQbv
72    6     7     5   1   4      3 EGjkvS
73    7     6     5   4   2      3 rJCv3P
74    7     3     4   2   4      4 SPfkuo
75    4     3     4   1   5      4 5BdsaG
76    6     4     1   1   3      1 sBU0MR
77    7     1     2   3   4      4 7cIEMt
78    3     1     4   2   3      4 zjzXQx
79    1     4     1   4   1      5 941bhn
80    4     2     1   3   5      1 89zOBT
81    5     6     3   3   3      3 XKzW8R</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>prac <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(labels) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
     labels     n
  &lt;dbl[1d]&gt; &lt;int&gt;
1         1    16
2         2    16
3         3    17
4         4    16
5         5    16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## mix up function</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>mix<span class="ot">&lt;-</span><span class="cf">function</span>(data,group){</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  df_filter<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(labels<span class="sc">==</span>group)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  out<span class="ot">=</span><span class="fu">sample</span>(df_filter<span class="sc">$</span>name,<span class="at">size=</span><span class="fu">length</span>(df_filter<span class="sc">$</span>labels))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>group_list<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">|&gt;</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) <span class="fu">mix</span>(prac,x))</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>tdf<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">t</span>(plyr<span class="sc">::</span><span class="fu">ldply</span>(group_list,rbind)))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjust colnames to show teammate</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tdf)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"teammate"</span>,<span class="dv">1</span><span class="sc">:</span>group_size))</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>na_vec<span class="ot">&lt;-</span><span class="fu">unlist</span>(tdf[(groups<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">length</span>(tdf[,<span class="dv">1</span>])),]) <span class="sc">%&gt;%</span> </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>na_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>teammate3 
 "eKC7zN" 
attr(,"na.action")
teammate1 teammate2 teammate4 teammate5 
        1         2         4         5 
attr(,"class")
[1] "omit"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>add_vec<span class="ot">&lt;-</span><span class="fu">c</span>(na_vec,<span class="fu">rep</span>(<span class="st">"NA"</span>,<span class="at">times=</span>(groups<span class="sc">-</span><span class="fu">length</span>(na_vec))))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>add_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>teammate3                                                                       
 "eKC7zN"      "NA"      "NA"      "NA"      "NA"      "NA"      "NA"      "NA" 
                                                                                
     "NA"      "NA"      "NA"      "NA"      "NA"      "NA"      "NA"      "NA" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tdf<span class="ot">=</span>tdf[<span class="dv">1</span><span class="sc">:</span>groups,]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>tdf<span class="sc">$</span>teammate6<span class="ot">&lt;-</span>add_vec</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>tdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   teammate1 teammate2 teammate3 teammate4 teammate5 teammate6
1     oDU0GS    WcEVoL    LwK1LO    Q3jXk3    fqMOZ5    eKC7zN
2     EdHx9P    1Gg23O    a20Apl    42Wmh4    r2DMIj        NA
3     1kCzui    jTrAcI    w6vLXX    FiLYko    BAZjsh        NA
4     huqmOZ    FdUwrM    JpSJ64    5BdsaG    qjLwe2        NA
5     e4QWwi    0450K7    KdphL7    VQM7IH    EUTQ2d        NA
6     89zOBT    Kyz2to    rJCv3P    iT7mRQ    MxNXvu        NA
7     YFmepe    lm8VbV    GBD339    zjzXQx    jzKwxt        NA
8     r2ykGf    YjrZ0u    iLwk3y    Y7RBQD    iHVQbv        NA
9     4sxVv8    e8Ljuh    XKzW8R    7cIEMt    941bhn        NA
10    sBU0MR    Tp7fUt    9kyyLO    uhGqKZ    LXbGCN        NA
11    gfuIvC    TUNRov    Udi4Qy    qDX8Kc    yTvtkf        NA
12    xRm9rC    S2B3wL    nD1rgw    aP4Wxh    1R9ihs        NA
13    UmngaK    NQ0u4V    To1zdQ    lN53op    OqkXsS        NA
14    0jiBeX    Ovnlxz    EGjkvS    iIHp52    iP9Lc3        NA
15    b1KH72    D2GiFE    MKAcOx    3cMauC    19Ql0b        NA
16    obQYmA    F5pWfP    MflWpW    SPfkuo    CakrNn        NA</code></pre>
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Reminder Python uses base 0. So the first index starts at 0 instead of 1 like in R<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>